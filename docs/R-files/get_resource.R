#| Extract Bible passage references #| source("https://delriaan.github.io/R-files/get_Bible_references.R")   local({   # :: Read text from clipboard   url <- svDialogs::dlgInput(message = "Enter web address, text, or 'clipboard' to read from the clipboard:", rstudio = FALSE)$res    if (url == "clipboard"){      if (grepl("Windows", osVersion)){        cli::cli_alert_info("Reading from clipboard ...")     }     doc <- readClipboard() |> paste(collapse = " ")   } else {     doc <- (\(x) if (stringi::stri_detect_regex(x, "^http")){         cli::cli_alert_info("URL detected: {x}")         res <- list()         res$html <- rvest::read_html(x)                res$plain <- res$html |>            rvest::html_text2() |>            # sapply(\(x) as.character(x)) |>            # paste(collapse = " ") |>           stringi::stri_replace_all_fixed("&mdash;", "-", vectorize_all = FALSE) |>           stringi::stri_replace_all_regex("\n|\t\r", " ", vectorize_all = FALSE)                # browser()         # res$plain <- rvest::html_text(res$html)          res     } else {x})(url)    }    # :: Extract patterns     .pattern <- paste0(       # Book number (optional)       "([0-9[:space:]]+)?"       # Book and chapter       , "([A-Z][a-z]{1,20}[[:space:]])+[0-9]{1,3}"       # No verse (optional)       # , "([;[:space:]]+)?"       # Anchor verse       , "([:][0-9]{1,3})?"       # Verse range (optional, use '.' instead of '-')       , "(.[0-9]{1,3})?"       # Verse range set (optional)       , "([,;[:space:]]+[0-9]{1,3}([:][0-9]{1,3})?(.[0-9]{1,3})?)?"       )      res <- stringi::stri_extract_all_regex(doc$plain, .pattern, simplify = TRUE) |>        purrr::reduce(c) |>        na.omit() |>       trimws() |>       unique()    # :: Show results and save to clipboard:   print(res)   writeClipboard(paste(res, collapse = "; ")) })